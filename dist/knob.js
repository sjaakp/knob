/*
 *  knob.js - transform <input type="number"> into a rotary control.
 *  (c) Sjaak Priester, Amsterdam, 2025 MIT license
 *  https://sjaakpriester.nl/software/knob
 *  https://github.com/sjaakp/knob
 */
function Knob(t){this.input=t,this.element=document.createElement("div"),this.element.className="knob",this.element.id=this.input.id+"-knob",t.replaceWith(this.element);const e=document.createElement("div");this.element.appendChild(e),e.appendChild(this.input);const n=this.element.getBoundingClientRect();this.x=n.left+n.width/2,this.y=n.top+n.height/2,this.ccw="ccw"===this.input.dataset.knob,this.min=this.input.min||0,this.max=this.input.max||100,this.onPointerMove=function(t){let e=Math.atan2(t.pageX-this.x,this.y-t.pageY);e<0&&(e+=2*Math.PI),this.setArc(e),this.input.value=this.arcToValue(e)}.bind(this),this.onPointerUp=function(){document.removeEventListener("pointerup",this.onPointerUp),document.removeEventListener("pointermove",this.onPointerMove)}.bind(this),this.element.addEventListener("pointerdown",t=>{document.addEventListener("pointerup",this.onPointerUp),document.addEventListener("pointermove",this.onPointerMove)}),this.input.addEventListener("input",t=>{this.setArc(this.valueToArc(t.target.value))}),this.setArc(this.valueToArc(this.input.value))}Knob.prototype={getRange(){return this.max-this.min},arcToValue(t){this.ccw&&(t=2*Math.PI-t);const e=this.getRange();return Math.round(e*t/(2*Math.PI)+this.min)},valueToArc(t){const e=this.getRange();if(0===e)return 0;const n=2*(t-=this.min)*Math.PI/e;return this.ccw?2*Math.PI-n:n},setValue(t){this.input.value=t,this.setArc(this.valueToArc(t))},setArc(t){this.element.style.backgroundImage=this.ccw?`conic-gradient(var(--knob-grey,lightgrey) 0 ${t}rad,var(--knob-color,orange) ${t}rad)`:`conic-gradient(var(--knob-color,orange) 0 ${t}rad,var(--knob-grey,lightgrey) ${t}rad)`}};const style=document.createElement("style");style.appendChild(document.createTextNode(".knob{place-content:center;place-items:center;width:var(--knob-diameter,6em);aspect-ratio:1;border-radius:500em;\ndiv{place-content:center;place-items:center;width:var(--knob-inner-diameter,75%);aspect-ratio:1;border-radius:500em;background-color:Canvas;user-select:none}}\n[data-knob]{display:block;max-width:6ch;field-sizing:content;&:focus{outline-width:1px}}")),document.head.appendChild(style),document.querySelectorAll("[data-knob]").forEach(t=>{new Knob(t)});